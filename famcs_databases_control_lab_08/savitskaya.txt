--Лабораторная выполняется в СУБД  Oracle. 
--Cкопируйте файл  edu8.txt  в каталог C:\TEMP .
--Раскройте файл и ознакомтесь со скриптом создания и заполнения таблиц для выполнения лабораторной. 
--Запустите скрипт edu8.txt на выполнение.
--Вставте в эту строку Ваши ФИО, номер группы, курса. ФИО Савицкая Елизавета Дмитриевна, группа 4, курс 4.      
--Файл с отчётом о выполнении лабораторной создаётся путём вставки скриптов, созданных 
--Вами операторов после пунктов 1- 10.
--Файл отчёта именуется фамилией студента  в английской транскрипции, с расширением .txt 
--и сохраняется в edufpmi.bsu.by.

--1.	Создайте таблицу emp_tel, с полями empno, phone_num. Первое из них - поле идентичное полю empno 
--таблицы emp и служит внешним ключом для связывания таблиц emp и emp_tel. 
--Второе поле – массив переменной длины с максимальным числом элементов равным четырём. 
--Поле может содержать телефоны сотрудника (рабочий, МТС, Велком, Лайф). 
DROP TABLE emp_tel;
/
CREATE OR REPLACE TYPE emp_phone_numbers AS VARRAY(4) OF VARCHAR2(30);
/
CREATE TABLE emp_tel (
  empno INTEGER NOT NULL REFERENCES emp(empno),
  phone_num emp_phone_numbers
);

--2.	Вставьте записи в таблицу  emp_tel со следующими данными:
--505, 2203415, 80297121314, 80296662332, Null
--303, 2240070, 80297744543, 80296667766, 80443345543
--503, 2233014, Null, 80296171717, 80443161612
--104, 22333015, 80297654321, Null, 90443939398
INSERT INTO  emp_tel VALUES(505, emp_phone_numbers('2203415', '80297121314', '80296662332', NULL));
INSERT INTO  emp_tel VALUES(303, emp_phone_numbers('2240070', '80297744543', '80296667766', '80443345543'));
INSERT INTO  emp_tel VALUES(503, emp_phone_numbers('2233014', NULL, '80296171717', '80443161612'));
INSERT INTO  emp_tel VALUES(104, emp_phone_numbers('22333015', '80297654321', NULL, '90443939398'));

--3.	Создайте запросы:
--a)	 для сотрудников с номерами 104, 303 указать имена и номера телефонов;
SELECT emp.empname, emp_tel.phone_num FROM emp_tel
    JOIN emp ON emp.empno = emp_tel.empno WHERE emp.empno IN (104, 303);
--b)	для сотрудника с номером 505, используя функцию Table, укажите его номер и телефоны.
SELECT emp_tel.empno, column_value FROM emp_tel, TABLE(phone_num) WHERE emp_tel.empno = 505;

--4.	Создайте таблицу children с полями empno, child. 
--Первое из них - поле идентичное полю empno таблицы emp и служит внешним ключом для связывания 
--таблиц emp и children. Второе является вложенной таблицей и содержит данные: об имени (name); 
--дате рождения ребёнка (birthdate), с ограничением: не ранее 01.01.1999;  и социализации (socialize), с ограничением: только из трёх
--значений: домашняя (home) до 6-ти лет включительно, детсадовская (kindergarten) от 3-х до 6-ти лет включительно, школьная (school) 
--старше 6-ти лет.
--DROP TABLE children;
--/
--DROP TYPE additional_clild_data_table;
--/
CREATE OR REPLACE TYPE clild_data AS OBJECT (
    name VARCHAR(50),
    birthdate DATE,
    socialize VARCHAR(20)
);
/
CREATE TYPE additional_clild_data_table IS TABLE OF clild_data;
/
CREATE TABLE children (
  empno NUMBER NOT NULL REFERENCES emp(empno),
  child additional_clild_data_table
) NESTED TABLE child STORE AS child_table;

--5.	Вставьте в таблицу children записи:
--для сотрудника с номером 102 двое детей: Jack, 02.02.2009, school
--				           Mari, 10.11.2014; school;

--для сотрудника с номером 327 двое детей: Alex, 22.09.2015, home
--					   Janis, 04.10.2020, home;

--для сотрудника с номером 404 двое детей: Garry, 14.10.2014, school
--					   Kris, 10.10.2016, kindergarten.
INSERT INTO children VALUES(102, additional_clild_data_table(
    clild_data('Jack', TO_DATE('02-02-2009','dd-mm-yyyy'), 'school'), 
    clild_data('Mari', TO_DATE('10-11-2014','dd-mm-yyyy'), 'school'))
);

INSERT INTO children VALUES(327, additional_clild_data_table(
    clild_data('Alex', TO_DATE('22-09-2015','dd-mm-yyyy'), 'home'),
    clild_data('Janis',TO_DATE('04-10-2020','dd-mm-yyyy'), 'home')
  )
);

INSERT INTO children VALUES(404, additional_clild_data_table(
    clild_data('Garry', TO_DATE('14-10-2014','dd-mm-yyyy'), 'school'),
    clild_data('Kris',TO_DATE('10-10-2016','dd-mm-yyyy'), 'kindergarten')
  )
);

--6.	Создайте запросы:
--a)	укажите все сведения из таблицы children;
SELECT temp.empno, tchild.* FROM children temp, TABLE(temp.child) tchild;

--b)	укажите номер сотрудника, имеющего ребёнка с именем Janis, вместе с именем ребёнка и датой рождения ребёнка;
SELECT temp.empno, tchild.* FROM children temp, TABLE(temp.child) tchild WHERE name = 'Janis';

--c)	укажите фамилию родителя, имя ребёнка, дату рождения ребёнка для всех школьников.
SELECT temp.empno, tchild.* FROM children temp, TABLE(temp.child) tchild WHERE name = 'school';

--7.	Измените дату рождения ребёнка с именем Alex на 10.10.2015.
UPDATE TABLE (SELECT child FROM children, TABLE(child) tchild WHERE tchild.name = 'Alex')
SET birthdate = TO_DATE('10-10-2015', 'dd-mm-yyyy') WHERE name = 'Alex';

--8.	Добавьте для сотрудника с номером 102 ребёнка с именем Julio и датой рождения 01.11.2021 и соответсвующей социализацией.
INSERT INTO TABLE (SELECT child FROM children WHERE empno = 102) VALUES (clild_data('Julio', TO_DATE('01-11-2021','dd-mm-yyyy'), 'home'));

--9.	Удалите сведения о ребёнке с именем Mari для сотрудника с номером 102.	
DELETE FROM TABLE (SELECT child FROM children WHERE empno = 102) temp where temp.name = 'Mari';

--10.	Удалите таблицы tel_emp, children.
DROP TABLE emp_tel;
DROP TABLE children;
DROP TYPE additional_clild_data_table;
DROP TYPE clild_data;